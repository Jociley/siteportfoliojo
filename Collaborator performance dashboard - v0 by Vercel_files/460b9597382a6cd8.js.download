(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,837062,e=>{"use strict";var t=e.i(346970),r=e.i(32170),n=e.i(743124);function i(){let{expectUser:e}=(0,r.useUser)(),{data:i,mutate:a}=(0,t.default)("scopes",async()=>{if(!e)return;let t=await fetch("/chat/api/scopes");return await t.json()},{dedupingInterval:6e4});return{scopes:i,isScopesReady:!!i,refreshScopes:(0,n.useCallback)(()=>{a(void 0,!0)},[a])}}e.s(["useScopes",()=>i])},873013,e=>{"use strict";var t=e.i(743124);let r=[[/\/chat\/([a-zA-Z0-9-_]+)/,["id"]]];function n(){let e=window.location.pathname,t={};for(let[n,i]of r){let r=e.match(n);if(r){for(let e=0;e<i.length;e++)t[i[e]]=r[e+1];break}}return t}let i=(0,t.cache)(()=>({}));function a(e,t){i()[e]=t}function o(e){delete i()[e]}e.s(["removeRewrittenParam",()=>o,"setRewrittenParam",()=>a,"useRewrittenParams",()=>n])},906261,e=>{"use strict";function t(e){return!!e&&!("membership"in e)}e.s(["isUserScope",()=>t])},222384,e=>{"use strict";function t(e){let{membership:t}=e;return!!t&&!!(t.entitlements&&t.entitlements.find(e=>"v0"===e.entitlement))}e.s(["teamMemberHasV0Access",()=>t])},691175,e=>{"use strict";function t(e){return!!e&&"limited"in e&&!0===e.limited}function r(e){var t;return!!e&&"limitedBy"in e&&(null==(t=e.limitedBy)?void 0:t.length)===1&&e.limitedBy.includes("mfa")}function n(e){let{slug:t,push:r}=e;r(o({slug:t}).toString())}function i(e){let{slug:t,push:r}=e;r(a({slug:t}).toString())}function a(e){let{slug:t,path:r}=e,n=new URLSearchParams({...r?{next:r}:{},teamSlug:t,twoFactorRequired:"1"});return"/api/auth/login?".concat(n.toString())}function o(e){let{slug:t,path:r}=e,n=new URLSearchParams({...r?{next:r}:{},teamSlug:t});return"/api/auth/login?".concat(n.toString())}function l(e){let{chatId:t,projectId:r,scopeSlug:n,lastUserInput:i}=e,a=(e,t)=>{let r=new URLSearchParams;for(let[e,n]of Object.entries(t))n&&r.set(e,n);return 0===r.size?e:"".concat(e,"?").concat(r.toString())};return t?a("/chat/".concat(t),{scope:n}):r?a("/project/".concat(r),{scope:n}):i?a("/chat",{q:i,scope:n,pid:r}):void 0}e.s(["generatePathFromContext",()=>l,"getLoginUrlToMissingScopeClient",()=>o,"getTwoFactorRequiredUrlClient",()=>a,"isAuthenticationRequired",()=>t,"isScopeLimitedOnlyByMfa",()=>r,"redirectToLoginToMissingScope",()=>n,"redirectToTwoFactorRequired",()=>i])},37737,e=>{"use strict";var t=e.i(490293),r=e.i(142219),n=e.i(753533);let i=(0,n.cacheResult)(null,()=>({dialogOpen:(0,t.atom)(null),visibleDialogType:(0,t.atom)(null),visibilityTimeout:(0,t.atom)(null)})),a=(0,n.cacheResult)(null,()=>({...i()}));e.s(["closeDialog",0,()=>{let e=i(),t=r.store.get(e.visibilityTimeout);t&&clearTimeout(t),r.store.set(e.visibleDialogType,null),r.store.set(e.visibilityTimeout,setTimeout(()=>{r.store.set(e.dialogOpen,null)},300))},"getDialogsAtoms",0,a,"openDialog",0,e=>{let t=i(),n=r.store.get(t.visibilityTimeout);n&&(clearTimeout(n),r.store.set(t.visibilityTimeout,null)),r.store.set(t.dialogOpen,e),r.store.set(t.visibleDialogType,e.type)}])},532733,e=>{"use strict";let t=(e.i(743124).default.cache||(e=>e))(function(e,t){var r;return(null==(r=e.membership)?void 0:r.entitlements)&&e.membership.entitlements.some(e=>"v0"===e.entitlement)||function(e){var t,r;let{user:n,team:i}=e;return"vercel"===i.slug&&!!(t=n)&&(t.teams.includes("vercel")||(null==(r=t.email)?void 0:r.endsWith("@zeit.pub")))}({user:t,team:e})});e.s(["teamMemberHasV0Entitlement",0,t],532733)},667660,929910,375465,e=>{"use strict";var t=e.i(346970),r=e.i(32170),n=e.i(743124),i=e.i(837062),a=e.i(873013),o=e.i(906261),l=e.i(979865),s=e.i(222384);e.i(563948);var c=e.i(407562),u=e.i(696871),d=e.i(691175),p=e.i(37737),m=e.i(509473),f=e.i(532733),g=e.i(783069),b=e.i(529693);function h(e){return(0,g.toSorted)(e,(e,t)=>{var r,n,i;return null!=(i=null==(r=e.name)?void 0:r.localeCompare(null!=(n=t.name)?n:""))?i:0})}function z(e){return(0,g.toSorted)(e,(e,t)=>{let r=(0,d.isAuthenticationRequired)(e),n=(0,o.isUserScope)(e)?"OWNER":e.membership.role,i=(0,d.isAuthenticationRequired)(t),a=(0,o.isUserScope)(t)?"OWNER":t.membership.role;return(r||"OWNER"===n?-1:0)-(i||"OWNER"===a?-1:0)})}function v(e){let{children:t}=e;return(0,m.jsx)(b.motion.div,{exit:{opacity:0,transition:{duration:.1}},initial:{opacity:0,filter:"blur(1px)",scale:.9},animate:{opacity:1,scale:1,filter:"blur(0px)"},className:"text-v0-gray-900",transition:{duration:.3},children:t})}function y(e,t){return(0,o.isUserScope)(e)||t&&(0,f.teamMemberHasV0Entitlement)(e,t)}e.s(["PresenceIcon",()=>v,"doesUserHaveV0Seat",()=>y,"sortScopesByAccess",()=>z,"sortScopesByName",()=>h],929910),e.i(541536);var S=e.i(23474);let E=S.z.enum(["speed","quality","vision"]),w=S.z.enum(["paid","grace_period","blocked","cancel","processing"]),C=S.z.enum(["hobby","pro","enterprise"]),A=S.z.enum(["on-demand-credits","high-quality","stealth","gallery","file-upload","qp-h","premium-themes","custom-subdomain","projects","premium-override"]),R=S.z.discriminatedUnion("type",[S.z.object({type:S.z.literal("feature"),name:A,config:S.z.object({level:S.z.literal("limited"),packages:S.z.array(S.z.object({costCents:S.z.number(),creditsAmount:S.z.number()})).optional()}).optional()}),S.z.object({type:S.z.literal("included_credits"),amount:S.z.number()}),S.z.object({type:S.z.literal("credits_cost_basis"),cents:S.z.number()}),S.z.object({type:S.z.literal("messages"),amount:S.z.number()})]),U=S.z.object({kind:S.z.literal("payment-failed"),reason:S.z.string(),paymentMethodId:S.z.string(),at:S.z.number(),invoiceUrl:S.z.string().optional()}),O=S.z.object({productKey:S.z.string(),name:S.z.string(),price:S.z.object({type:S.z.literal("unit"),cents:S.z.number()})}),I=S.z.enum(["v0-level0","v0-level3","v0-team","v0-enterprise","v0-platinum"]),j=S.z.object({slug:I,name:S.z.string(),selfServe:S.z.boolean(),defaultEntitlements:S.z.array(R),items:S.z.array(O)}),T=S.z.object({notices:S.z.array(U),plan:j,items:S.z.array(O),startDate:S.z.string(),endDate:S.z.string().nullable(),upcomingPlanChange:S.z.object({start:S.z.string(),plan:S.z.object({name:S.z.string()})}).nullable(),remainingBalance:S.z.string().nullable(),processingPayment:S.z.string().nullable(),realPlan:j.optional()}),D=T.extend({status:S.z.literal("active"),currentPlanStartDate:S.z.string().optional(),currentBillingPeriod:S.z.object({start:S.z.string(),end:S.z.string()})}),P=T.extend({status:S.z.union([S.z.literal("upcoming"),S.z.literal("ended")]),currentBillingPeriod:S.z.null(),endDate:S.z.string()}),k=S.z.union([D,P]),V=S.z.object({last4:S.z.string(),brand:S.z.string(),exp:S.z.object({month:S.z.number().optional(),year:S.z.number().optional()}).optional(),email:S.z.string().optional()}).extend({id:S.z.string(),type:S.z.literal("card")});S.z.object({stripeCustomerId:S.z.string(),subscription:k.optional(),settings:S.z.object({mode:S.z.union([S.z.literal("test"),S.z.literal("live")])}),ownerId:S.z.string(),entitlements:S.z.array(R),paymentMethod:V.optional()}),S.z.object({plan:S.z.nullable(C),stripeCustomerId:S.z.string(),awsMarketplace:S.z.object({v0:S.z.object({customerId:S.z.string(),productCode:S.z.string()}).optional(),vercel:S.z.object({customerId:S.z.string(),productCode:S.z.string()}).optional()}).optional(),plans:S.z.array(S.z.object({slug:S.z.string(),status:S.z.union([S.z.literal("active"),S.z.literal("ended")]),billingPeriodStartDate:S.z.number().optional(),billingPeriodEndDate:S.z.number().optional(),subscriptionEndDate:S.z.number().optional(),remainingBalance:S.z.number().optional()})),products:S.z.array(S.z.object({slug:S.z.string(),prices:S.z.array(S.z.object({type:S.z.string(),billableItemSlug:S.z.string(),quantity:S.z.number()}))})),payment:S.z.object({status:S.z.union([S.z.literal("paid"),S.z.literal("pending"),S.z.literal("processing"),S.z.literal("past_due")]),openInvoices:S.z.array(S.z.object({url:S.z.string(),dueAt:S.z.number()}))}).optional()}),S.z.object({slug:S.z.string(),status:S.z.union([S.z.literal("active"),S.z.literal("ended")]),billingPeriodStartDate:S.z.number().optional(),billingPeriodEndDate:S.z.number().optional(),subscriptionEndDate:S.z.number().optional(),remainingBalance:S.z.number().optional()});let L=["V0Builder","V0Chatter","V0Viewer"],N=["V0Builder","V0Chatter"],B=S.z.enum(["OWNER","MEMBER","DEVELOPER","BILLING","VIEWER","CONTRIBUTOR"]);S.z.object({vercelToken:S.z.string(),created:S.z.number().int().positive().optional(),v0plan:S.z.string().nullish(),features:S.z.array(A).optional(),quality:E.optional(),user:S.z.object({id:S.z.string(),username:S.z.string(),email:S.z.string(),avatar:S.z.string(),avatarSha:S.z.string().nullish().transform(e=>null===e?void 0:e),createdAt:S.z.string().optional(),name:S.z.string().nullish().transform(e=>null===e?void 0:e),defaultTeamId:S.z.string().nullish(),plan:S.z.union([C,S.z.literal("anon")]),scope:S.z.string().optional(),v0plan:I.nullish(),realv0Plan:I.nullish(),billingCycleStart:S.z.number().optional(),billingCycleEnd:S.z.number().optional(),paymentStatus:w.optional(),scopeVercelPlan:C.optional(),teamRole:B.nullish(),teamV0Role:S.z.enum(L).nullish(),teamId:S.z.string().nullish(),teamName:S.z.string().optional(),teams:S.z.array(S.z.string()),v:S.z.number().optional(),title:S.z.string().optional(),x:S.z.string().optional(),github:S.z.string().optional(),website:S.z.string().optional(),description:S.z.string().optional(),verified:S.z.boolean().optional(),isAmbassador:S.z.boolean().optional(),location:S.z.string().optional(),isPrivate:S.z.boolean().optional(),limited:S.z.boolean().optional(),billingMode:S.z.literal("test").optional(),stripeCustomerId:S.z.string().nullish().transform(e=>null===e?void 0:e),acceptedTosAt:S.z.number().optional()}),team:S.z.object({billingCycleStart:S.z.number().optional(),billingCycleEnd:S.z.number().optional(),isTokenBasedEnt:S.z.literal(!0).optional()}).optional(),impersonation:S.z.boolean().optional(),actor:S.z.string().optional()});var M=e.i(957573),x=e.i(827330),_=e.i(355045),F=e.i(887139),q=e.i(391795),H=e.i(9694),W=e.i(762380),J=e.i(957212),K=e.i(642790),G=e.i(518273),Q=e.i(726295),Y=e.i(912866),Z=e.i(635316),$=e.i(649440),X=e.i(754883),ee=e.i(265540),et=e.i(671183),er=e.i(612034),en=e.i(396350),ei=e.i(880092);let ea=n.default.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}}),eo={dedupe:!0};x.OBJECT.defineProperty(_.SWRConfig,"defaultValue",{value:F.defaultConfig});let el=(0,q.withArgs)((e,t,r)=>{let{cache:i,compare:a,suspense:o,fallbackData:l,revalidateOnMount:s,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:p,keepPreviousData:m}=r,[f,g,b,h]=H.SWRGlobalState.get(i),[z,v]=(0,W.serialize)(e),y=(0,n.useRef)(!1),S=(0,n.useRef)(!1),E=(0,n.useRef)(z),w=(0,n.useRef)(t),C=(0,n.useRef)(r),A=()=>C.current.isVisible()&&C.current.isOnline(),[R,U,O,I]=(0,J.createCacheHelper)(i,z),j=(0,n.useRef)({}).current,T=(0,K.isUndefined)(l)?(0,K.isUndefined)(r.fallback)?G.UNDEFINED:r.fallback[z]:l;T&&(0,Q.isPromiseLike)(T)&&(T=ea(T));let D=(e,t)=>{for(let r in j)if("data"===r){if(!a(e[r],t[r])&&(!(0,K.isUndefined)(e[r])||!a(F,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},P=(0,n.useMemo)(()=>{let e=!!z&&!!t&&((0,K.isUndefined)(s)?!C.current.isPaused()&&!o&&!1!==c:s),r=t=>{let r=(0,ei.mergeObjects)(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},n=R(),i=I(),a=r(n),l=n===i?a:r(i),u=a;return[()=>{let e=r(R());return D(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>l]},[i,z]),k=(0,M.useSyncExternalStore)((0,n.useCallback)(e=>O(z,(t,r)=>{D(r,t)||e()}),[i,z]),P[0],P[1]),V=!y.current,L=f[z]&&f[z].length>0,N=k.data,B=(0,K.isUndefined)(N)?T:N,x=k.error,_=(0,n.useRef)(B),F=m?(0,K.isUndefined)(N)?_.current:N:B,el=(!L||!!(0,K.isUndefined)(x))&&(V&&!(0,K.isUndefined)(s)?s:!C.current.isPaused()&&(o?!(0,K.isUndefined)(B)&&c:(0,K.isUndefined)(B)||c)),es=!!(z&&t&&V&&el),ec=(0,K.isUndefined)(k.isValidating)?es:k.isValidating,eu=(0,K.isUndefined)(k.isLoading)?es:k.isLoading,ed=(0,n.useCallback)(async e=>{let t,n,i=w.current;if(!z||!i||S.current||C.current.isPaused())return!1;let o=!0,l=e||{},s=!b[z]||!l.dedupe,c=()=>en.IS_REACT_LEGACY?!S.current&&z===E.current&&y.current:z===E.current,u={isValidating:!1,isLoading:!1},d=()=>{U(u)},p=()=>{let e=b[z];e&&e[1]===n&&delete b[z]},m={isValidating:!0};(0,K.isUndefined)(R().data)&&(m.isLoading=!0);try{if(s&&(U(m),r.loadingTimeout&&(0,K.isUndefined)(R().data)&&setTimeout(()=>{o&&c()&&C.current.onLoadingSlow(z,r)},r.loadingTimeout),b[z]=[i(v),(0,Y.getTimestamp)()]),[t,n]=b[z],t=await t,s&&setTimeout(p,r.dedupingInterval),!b[z]||b[z][1]!==n)return s&&c()&&C.current.onDiscarded(z),!1;u.error=G.UNDEFINED;let e=g[z];if(!(0,K.isUndefined)(e)&&(n<=e[0]||n<=e[1]||0===e[1]))return d(),s&&c()&&C.current.onDiscarded(z),!1;let l=R().data;u.data=a(l,t)?l:t,s&&c()&&C.current.onSuccess(t,z,r)}catch(r){p();let e=C.current,{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=r,s&&c()&&(e.onError(r,z,e),(!0===t||(0,Z.isFunction)(t)&&t(r))&&(!C.current.revalidateOnFocus||!C.current.revalidateOnReconnect||A())&&e.onErrorRetry(r,z,e,e=>{let t=f[z];t&&t[0]&&t[0]($.revalidateEvents.ERROR_REVALIDATE_EVENT,e)},{retryCount:(l.retryCount||0)+1,dedupe:!0})))}return o=!1,d(),!0},[z,i]),ep=(0,n.useCallback)(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,X.internalMutate)(i,E.current,...t)},[]);if((0,ee.useIsomorphicLayoutEffect)(()=>{w.current=t,C.current=r,(0,K.isUndefined)(N)||(_.current=N)}),(0,ee.useIsomorphicLayoutEffect)(()=>{if(!z)return;let e=ed.bind(G.UNDEFINED,eo),t=0,r=(0,q.subscribeCallback)(z,f,function(r){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r==$.revalidateEvents.FOCUS_EVENT){let r=Date.now();C.current.revalidateOnFocus&&r>t&&A()&&(t=r+C.current.focusThrottleInterval,e())}else if(r==$.revalidateEvents.RECONNECT_EVENT)C.current.revalidateOnReconnect&&A()&&e();else if(r==$.revalidateEvents.MUTATE_EVENT)return ed();else if(r==$.revalidateEvents.ERROR_REVALIDATE_EVENT)return ed(n)});return S.current=!1,E.current=z,y.current=!0,U({_k:v}),el&&((0,K.isUndefined)(B)||et.IS_SERVER?e():(0,er.rAF)(e)),()=>{S.current=!0,r()}},[z]),(0,ee.useIsomorphicLayoutEffect)(()=>{let e;function t(){let t=(0,Z.isFunction)(u)?u(R().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!R().error&&(d||C.current.isVisible())&&(p||C.current.isOnline())?ed(eo).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,p,z]),(0,n.useDebugValue)(F),o&&(0,K.isUndefined)(B)&&z){if(!en.IS_REACT_LEGACY&&et.IS_SERVER)throw Error("Fallback data is required when using Suspense in SSR.");w.current=t,C.current=r,S.current=!1;let e=h[z];if((0,K.isUndefined)(e)||ea(ep(e)),(0,K.isUndefined)(x)){let e=ed(eo);(0,K.isUndefined)(F)||(e.status="fulfilled",e.value=!0),ea(e)}else throw x}return{mutate:ep,get data(){return j.data=!0,F},get error(){return j.error=!0,x},get isValidating(){return j.isValidating=!0,ec},get isLoading(){return j.isLoading=!0,eu}}}),es=(0,q.withMiddleware)(el,e=>(t,r,n)=>(n.revalidateOnFocus=!1,n.revalidateIfStale=!1,n.revalidateOnReconnect=!1,e(t,r,n)));e.s(["default",()=>es],375465);class ec extends Error{constructor(e,t){super(e),this.name="DevalueError",this.path=t.join("")}}function eu(e){return Object(e)!==e}let ed=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ep(e){let t="",r=0,n=e.length;for(let i=0;i<n;i+=1){let n=function(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?"\\u".concat(e.charCodeAt(0).toString(16).padStart(4,"0")):""}}(e[i]);n&&(t+=e.slice(r,i)+n,r=i+1)}return'"'.concat(0===r?e:t+e.slice(r),'"')}let em=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function ef(e){return em.test(e)?"."+e:"["+JSON.stringify(e)+"]"}function eg(e){let t=new DataView(e),r="";for(let n=0;n<e.byteLength;n++)r+=String.fromCharCode(t.getUint8(n));var n=r;let i="";for(let e=0;e<n.length;e+=3){let t=[void 0,void 0,void 0,void 0];t[0]=n.charCodeAt(e)>>2,t[1]=(3&n.charCodeAt(e))<<4,n.length>e+1&&(t[1]|=n.charCodeAt(e+1)>>4,t[2]=(15&n.charCodeAt(e+1))<<2),n.length>e+2&&(t[2]|=n.charCodeAt(e+2)>>6,t[3]=63&n.charCodeAt(e+2));for(let e=0;e<t.length;e++)void 0===t[e]?i+="=":i+=eh[t[e]]}return i}function eb(e){let t=function(e){e.length%4==0&&(e=e.replace(/==?$/,""));let t="",r=0,n=0;for(let i=0;i<e.length;i++)r<<=6,r|=eh.indexOf(e[i]),24===(n+=6)&&(t+=String.fromCharCode((0xff0000&r)>>16),t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r),r=n=0);return 12===n?(r>>=4,t+=String.fromCharCode(r)):18===n&&(r>>=2,t+=String.fromCharCode((65280&r)>>8),t+=String.fromCharCode(255&r)),t}(e),r=new ArrayBuffer(t.length),n=new DataView(r);for(let e=0;e<r.byteLength;e++)n.setUint8(e,t.charCodeAt(e));return r}let eh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function ez(e,t){let r=[],n=new Map,i=[];if(t)for(let e of Object.getOwnPropertyNames(t))i.push({key:e,fn:t[e]});let a=[],o=0,l=function e(t){if("function"==typeof t)throw new ec("Cannot stringify a function",a);if(n.has(t))return n.get(t);if(void 0===t)return -1;if(Number.isNaN(t))return -3;if(t===1/0)return -4;if(t===-1/0)return -5;if(0===t&&1/t<0)return -6;let l=o++;for(let{key:a,fn:o}of(n.set(t,l),i)){let n=o(t);if(n)return r[l]='["'.concat(a,'",').concat(e(n),"]"),l}let s="";if(eu(t))s=ev(t);else{let r=Object.prototype.toString.call(t).slice(8,-1);switch(r){case"Number":case"String":case"Boolean":s='["Object",'.concat(ev(t),"]");break;case"BigInt":s='["BigInt",'.concat(t,"]");break;case"Date":let n=!isNaN(t.getDate());s='["Date","'.concat(n?t.toISOString():"",'"]');break;case"RegExp":let{source:i,flags:o}=t;s=o?'["RegExp",'.concat(ep(i),',"').concat(o,'"]'):'["RegExp",'.concat(ep(i),"]");break;case"Array":s="[";for(let r=0;r<t.length;r+=1)r>0&&(s+=","),r in t?(a.push("[".concat(r,"]")),s+=e(t[r]),a.pop()):s+=-2;s+="]";break;case"Set":for(let r of(s='["Set"',t))s+=",".concat(e(r));s+="]";break;case"Map":for(let[r,n]of(s='["Map"',t))a.push(".get(".concat(eu(r)?ev(r):"...",")")),s+=",".concat(e(r),",").concat(e(n)),a.pop();s+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":s='["'+r+'","'+eg(t.buffer)+'"]';break;case"ArrayBuffer":{let e=eg(t);s='["ArrayBuffer","'.concat(e,'"]');break}default:if(!function(e){let t=Object.getPrototypeOf(e);return t===Object.prototype||null===t||Object.getOwnPropertyNames(t).sort().join("\0")===ed}(t))throw new ec("Cannot stringify arbitrary non-POJOs",a);if(Object.getOwnPropertySymbols(t).filter(e=>Object.getOwnPropertyDescriptor(t,e).enumerable).length>0)throw new ec("Cannot stringify POJOs with symbolic keys",a);if(null===Object.getPrototypeOf(t)){for(let r in s='["null"',t)a.push(ef(r)),s+=",".concat(ep(r),",").concat(e(t[r])),a.pop();s+="]"}else{s="{";let r=!1;for(let n in t)r&&(s+=","),r=!0,a.push(ef(n)),s+="".concat(ep(n),":").concat(e(t[n])),a.pop();s+="}"}}}return r[l]=s,l}(e);return l<0?"".concat(l):"[".concat(r.join(","),"]")}function ev(e){let t=typeof e;return"string"===t?ep(e):e instanceof String?ep(e.toString()):void 0===e?"-1":0===e&&1/e<0?"-6":"bigint"===t?'["BigInt","'.concat(e,'"]'):String(e)}function ey(e,t){var r=JSON.parse(e),n=t;if("number"==typeof r)return a(r,!0);if(!Array.isArray(r)||0===r.length)throw Error("Invalid input");let i=Array(r.length);function a(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(-1===e)return;if(-3===e)return NaN;if(-4===e)return 1/0;if(-5===e)return-1/0;if(-6===e)return -0;if(t)throw Error("Invalid input");if(e in i)return i[e];let o=r[e];if(o&&"object"==typeof o)if(Array.isArray(o))if("string"==typeof o[0]){let t=o[0],r=null==n?void 0:n[t];if(r)return i[e]=r(a(o[1]));switch(t){case"Date":i[e]=new Date(o[1]);break;case"Set":let l=new Set;i[e]=l;for(let e=1;e<o.length;e+=1)l.add(a(o[e]));break;case"Map":let s=new Map;i[e]=s;for(let e=1;e<o.length;e+=2)s.set(a(o[e]),a(o[e+1]));break;case"RegExp":i[e]=new RegExp(o[1],o[2]);break;case"Object":i[e]=Object(o[1]);break;case"BigInt":i[e]=BigInt(o[1]);break;case"null":let c=Object.create(null);i[e]=c;for(let e=1;e<o.length;e+=2)c[o[e]]=a(o[e+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{let r=new globalThis[t](eb(o[1]));i[e]=r;break}case"ArrayBuffer":{let t=eb(o[1]);i[e]=t;break}default:throw Error("Unknown type ".concat(t))}}else{let t=Array(o.length);i[e]=t;for(let e=0;e<o.length;e+=1){let r=o[e];-2!==r&&(t[e]=a(r))}}else{let t={};for(let r in i[e]=t,o){let e=o[r];t[r]=a(e)}}else i[e]=o;return i[e]}return a(0)}let eS="scopes",eE=e=>null!==e&&"team"===eR(e),ew=()=>{var e;let c=(0,l.useRouter)(),{user:m,setUser:f,expectUser:g}=(0,r.useUser)(),{scopes:b,isScopesReady:h,refreshScopes:z}=(0,i.useScopes)(),v=!!(h&&(!g||m)),{data:S,mutate:E,isLoading:w}=(0,t.default)(v?"activeScope":null,async()=>{var e,t,r;let n=null!=(e=null==b?void 0:b.find(o.isUserScope))?e:null,i=new URLSearchParams(window.location.search).get("scope");if(i){c.replace(window.location.pathname);let e=null==b?void 0:b.find(e=>(0,o.isUserScope)(e)?e.username===i:e.slug===i&&(0,s.teamMemberHasV0Access)({membership:e.membership}));if(e){let t=eA(e),{user:r}=await eC(t);return f(r),e}}let a=null==m?void 0:m.scope;if(!a){if(null==m?void 0:m.limited){let e=null!=(t=null==b?void 0:b.find(e=>!(0,o.isUserScope)(e)&&!e.limited&&(0,s.teamMemberHasV0Access)({membership:e.membership})))?t:null;if(e){let t=eA(e),{user:r}=await eC(t);f(r)}return e}if(!n&&(null==b?void 0:b[0])&&u.PERSONAL_OPT_OUT_TEAM_IDS.includes(b[0].id)){let e=eA(b[0]),{user:t}=await eC(e);return f(t),c.refresh(),b[0]}return n}let[l,p]=a.split(":");if("team"===l){let e=null!=(r=null==b?void 0:b.find(e=>"slug"in e&&e.slug===p&&(0,s.teamMemberHasV0Access)({membership:e.membership})))?r:null;if((0,d.isScopeLimitedOnlyByMfa)(e))return(0,d.redirectToTwoFactorRequired)({slug:p,push:c.push}),null;if((null==e?void 0:e.limited)&&!(0,o.isUserScope)(e)){let{user:e}=await eC(p);f(e)}return e}return n},{revalidateIfStale:!1}),C=(0,n.useCallback)(async function(e){let{currentChatId:t,currentProjectId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="slug"in e?e.slug:void 0,i=eA(e),{user:o,redirectingToHome:l}=await eC(i,{currentChatId:t,currentProjectId:r});f(o),n?(0,a.setRewrittenParam)("scope",n):(0,a.removeRewrittenParam)("scope"),l||c.refresh(),E(e,{optimisticData:e,revalidate:!1})},[E,c,f]),A=(0,n.useMemo)(()=>h&&m&&!w&&null!=S?S:null,[h,m,S,w]);(0,n.useEffect)(()=>{if(b&&A&&m){let e=localStorage.getItem(eS);try{let t=e?JSON.parse(e):[],r=new Set(t.filter(e=>"slug"in e).map(e=>e.id)),n=b.filter(e=>"slug"in e&&!r.has(e.id)&&e.id!==A.id&&!0===y(e,m));n.length>0&&e&&(0,p.openDialog)({type:"joinedNewTeams",data:{teams:n}})}catch(e){console.error(e)}localStorage.setItem(eS,JSON.stringify(b))}},[b,A,m]);let R=(0,n.useMemo)(()=>{var e;return null!=(e=function(e){return e?(0,o.isUserScope)(e)?e.username:e.slug:null}(A))?e:void 0},[A]),U=(0,n.useMemo)(()=>"team"===eR(A),[A]),O=v&&void 0!==S,I=eE(A)?null==(e=A.membership.teamPermissions)?void 0:e.find(e=>L.includes(e)):null,j=(!I||N.includes(I))&&!(null==m?void 0:m.isImpersonation),T=(!I||"V0Builder"===I)&&!(null==m?void 0:m.isImpersonation);return{activeScope:A,activeScopeSlug:R,isActiveScopeReady:O,isTeam:U,setActiveScope:C,scopes:b,user:m,refreshScopes:z,hasWritePermission:j,hasVercelWritePermission:T,isNewV0Rbac:!!I}};async function eC(e){let{currentChatId:t,currentProjectId:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t?"&currentChatId=".concat(encodeURIComponent(t)):"",i=r?"&currentProjectId=".concat(encodeURIComponent(r)):"",a=await fetch("/chat/api/team/change-scope?scope=".concat(encodeURIComponent(e)).concat(n).concat(i),{method:"POST"});if(403===a.status){let e=await a.json();e.redirect?window.location.href=e.redirect:c.toast.error("You must be a team owner to upgrade your team.")}if(!a.ok)throw Error("Failed to update team slug cookie");let o=await a.json();if(!o.success)throw Error("Failed to update team slug cookie");return o.redirect&&(window.location.href=o.redirect),{user:o.user,redirectingToHome:!!o.redirect}}function eA(e){return(0,o.isUserScope)(e)?"user:".concat(e.username):"team:".concat(e.slug)}function eR(e){return e?(0,o.isUserScope)(e)?"user":"team":null}function eU(){var e;let t=ew(),{cachedData:r}=function(e){let{cacheKey:t,userId:r,currentData:i,serialize:a=ez,deserialize:o=ey,ttl:l}=e,s=r?"".concat(t,"-").concat(r):null,{data:c,mutate:u,isLoading:d}=es(s?"cached-".concat(t,"-").concat(r):null,()=>{if(!s)return null;try{let e=localStorage.getItem(s);if(!e)return null;let t=o(e);if(l&&t.timestamp&&Date.now()-t.timestamp>l)return localStorage.removeItem(s),null;return void 0!==t.data?t.data:t}catch(r){let e=r instanceof SyntaxError||(null==r?void 0:r.name)==="DevalueError",t=r instanceof DOMException&&"QuotaExceededError"===r.name;if(e){console.warn("[useLocalStorageCache] Parse error for ".concat(s,", removing corrupted cache:"),r);try{localStorage.removeItem(s)}catch(e){console.error("Failed to remove corrupted cache for ".concat(s,":"),e)}}else if(t)console.warn("[useLocalStorageCache] Storage quota exceeded for ".concat(s,":"),r);else{console.warn("[useLocalStorageCache] Unexpected error accessing cache for ".concat(s,":"),r);try{localStorage.removeItem(s)}catch(e){}}return null}},{keepPreviousData:!0});return(0,n.useEffect)(()=>{if(i&&s)try{let e={data:i,timestamp:Date.now()};localStorage.setItem(s,a(e)),u(i,{revalidate:!1})}catch(r){let e=r instanceof DOMException&&"QuotaExceededError"===r.name,t=(null==r?void 0:r.name)==="DevalueError";e?console.warn("[useLocalStorageCache] Storage quota exceeded, cannot cache data for ".concat(s,":"),r):t?console.warn("[useLocalStorageCache] Serialization failed for ".concat(s,":"),r):console.warn("[useLocalStorageCache] Failed to cache data for ".concat(s,":"),r)}},[i,s,a,u]),{cachedData:c,updateCache:e=>{if(e&&s)try{let t={data:e,timestamp:Date.now()};localStorage.setItem(s,a(t))}catch(r){let e=r instanceof DOMException&&"QuotaExceededError"===r.name,t=(null==r?void 0:r.name)==="DevalueError";e?console.warn("[useLocalStorageCache] Storage quota exceeded, cannot update cache for ".concat(s,":"),r):t?console.warn("[useLocalStorageCache] Serialization failed during manual update for ".concat(s,":"),r):console.warn("[useLocalStorageCache] Failed to manually update cache for ".concat(s,":"),r)}return u(e,{revalidate:!1})},clearCache:()=>(s&&localStorage.removeItem(s),u(null,{revalidate:!1})),isLoading:d,storageKey:s}}({cacheKey:"scopes",userId:null==(e=t.user)?void 0:e.id,currentData:t.scopes}),i=(0,n.useMemo)(()=>{if(t.activeScope||!t.user)return t.activeScope;if(r&&r.length>0&&!t.isActiveScopeReady){let e=r.find(e=>(0,o.isUserScope)(e)),n=t.user.scope;if(n){let[e,t]=n.split(":");if("team"===e){let e=r.find(e=>"slug"in e&&e.slug===t);if(e)return e}}return e||null}return t.activeScope},[t.activeScope,t.user,t.isActiveScopeReady,r]),a=(0,n.useMemo)(()=>t.isActiveScopeReady||!!(null==r?void 0:r.length)&&t.user&&null!==i,[t.isActiveScopeReady,r,t.user,i]);return{...t,activeScope:i,isActiveScopeReady:a,scopes:t.scopes||r||[]}}e.s(["getScopeCookieKey",()=>eA,"scopeIsTeam",0,eE,"updateTeamSlugCookie",()=>eC,"useActiveScope",0,ew,"useActiveScopeLocalStorage",()=>eU],667660)}]);